<!DOCTYPE html>
<html id="thehtml" lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">

  <title>Dashboard - BCH Admin</title>
  <meta content="Bitcoin Cash Web Wallet built with clientside JavaScript." name="description">
  <meta content="Bitcoin Cash, JavaScript, Web Wallet" name="keywords">
  
  <!-- Favicons --> 
  <link href="assets/img/bitcoin-cash-circle-icon-192.png" rel="icon">
  <link href="assets/img/bitcoin-cash-circle-icon-192.png" rel="apple-touch-icon">

  <!-- Google Fonts TODO: Replace with included static/downloaded fonts -->
  <link href="https://fonts.gstatic.com" rel="preconnect">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Nunito:300,300i,400,400i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">
  <!--   <link href="assets/css/opensans.css" rel="stylesheet"> -->

  <!-- CSS Files -->
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/box-icons/boxicons.min.css" rel="stylesheet"> 
  <link href="assets/vendor/remix-icons/remixicon.css" rel="stylesheet"> 

  <link href="assets/css/jquery.dataTables.min.css" rel="stylesheet">


  <!-- Main CSS File -->
  <link href="assets/css/style.css" rel="stylesheet">

<!--
  * ========================================
  * BCH Admin was created by KeepBitcoinFree.org as a personal project in 2023.
  * It uses the mainnet-js library & all libraries are hosted locally to the app. Learn more about https://mainnet.cash
  * The wallet is serverless and uses vanilla client-side JavaScript. All Private Keys are created and stored locally in the browser's IndexedDB Storage.
  * The source code consists of the HTML page and other assets: css & javascript files, hosted locally. These files can be downloaded and run locally; only an internet connection and a browser capable of running JavaScript is required to create a new wallet, send/recieve BCH, or sign/verify a message.
  *
  * For now 1 cookie/browser/website (combo) = one user/wallet. Keys are stored within the indexedDB in the local user's browser and local to that device, browser & website.
  *
  * Using a private session will create a new wallet each time the website is opened.
  * TODO: *Maybe* add ability to create user & log-in so the user could create multiple wallets for each user.
  * DONE: Added functionality to print the webpage as a PAPER WALLET. Also link to paper.keepbitcoinfree.org for an official BCH paper wallet.
  * TODO: Add functionality to restore a wallet from seed *En progress.
  * TODO: Add functionality for PointOfSale system. Use the xpub key to display a screen that has a new address for each order. Watch that address while open, and generate success modal/page etc.
  * - From the xPub, we generate addresses starting from the first address in the sequence, and a new address from the next one in the sequence for every new order, using the BIP44 derivation path.
  * =======================================
-->



<!-- TODO: Generate DataTable and Setup Checkboxes only after wallet utxos have been hydrated. Right now it is just waiting 3-4 seconds for each to run. -->

  <!-- CUSTOM SCRIPTS for BITCOIN CASH WALLET using MAINNET.CASH -->
  <script src="assets/js/indexeddb-storage-2.3.0.js"></script>  
  <script src="assets/js/mainnet-2.3.0.js"></script>
  
  <!-- Scripts for jQuery & DataTables -->
  <script src="assets/js/jquery-3.6.4.min.js"></script>
  <script src="assets/js/jquery.dataTables.min.js"></script>

  <!-- Custom Wallet Functionality JavaScript - written by Zatoshi - https://github.com/KeepBitcoinFree-org - utilizing the open source Mainnet.cash JS Library -->
  <script type="text/javascript">
      
      // Global Vars \\
      
      // Set USERID. This is used to identify the wallet. A new userid = a new wallet. Right now this is only unique to the website. 
      // Each time the site is visited, it creates a new cookie with this userid - which it uses to create/reference the BCH wallet.
      const userid = 'user:4202215252322';
      // Create Formatter to format numbers.
      const US = new Intl.NumberFormat();
      let thebchPrice = 0;

    // RUN when the DOM Content has been loaded  
    document.addEventListener("DOMContentLoaded", async (event) => {
      globalThis.exports = globalThis.exports || {};
      Object.assign(globalThis, await __mainnetPromise);
      
      // Fix for loading persistent named wallets from IndexDB Storage Provider.
      BaseWallet.StorageProvider = IndexedDBProvider;
      
      // Get and Print Date to console
      let date = Date.now();
      console.log('Date is... ' + date);
      console.log('userid = ' + userid);

      // const userPrefersDark = false;
      // const walletExists = localStorage.getItem("isnew") === "false";

      // Using the mainnet.cash wallet.namedExists() to check if user has created wallet
      const walletExists = await Wallet.namedExists(userid);
      console.log('Wallet Exists? ' + walletExists)
      
      // If the wallet exists, set the walletId
      if(walletExists){

        // if yes, get/set the walletid in localStorage.
        let walletId = localStorage.getItem("walletId");
          if(!walletId || walletId === ''){
           //wallet exists BUT the walletId hasn't yet been set. That means it's an old wallet (using the default derivation)
           //Create the named wallet (with userid) and create/set the walletId in localStorage **This will preserve old/previously created wallets.
           const wallet = await Wallet.named(userid);

           const derivation = wallet.derivationPath;
           // ISSUE - default derivation is "m/44'/0'/0'/0/0"
           // ** WHEN CREATING A NEW WALLET, I'LL NEED TO CREATE ONE, THEN USE THAT SEED TO CREATE A NEW ONE WITH THE CORRECT DERIVATION
           // use the userid to create wallet1, then use that seed to create wallet with proper derivation.
           const seed = wallet.mnemonic;
           // const derivationPath = "m/44'/145'/0'/0/0";
           // Create user wallet using supplied seed & derivation path.
           walletId = 'seed:mainnet:' + seed + ':' + derivation;
           localStorage.setItem("walletId", walletId);
           console.log('walletId created from existing wallet - ' + walletId);
            // Get Wallet Balance
          wallet.balance = await wallet.getBalance();
         // Get all UTXOs for wallet. Use this to provide UTXO selection to wallet via datatable
         wallet.utxos = await wallet.getUtxos();
         // Load the wallet
          loadWallet(wallet);

          }else{
            console.log('walletId is not blank, value = ' + walletId);
            const wallet = await Wallet.replaceNamed(userid, walletId);
            // Get Wallet Balance
            wallet.balance = await wallet.getBalance();
            // Get all UTXOs for wallet. Use this to provide UTXO selection to wallet via datatable
            wallet.utxos = await wallet.getUtxos();
            // Load the wallet
            loadWallet(wallet);
          }

        
        
      }else{
        // Wallet does not exist, show newwalletview div.
        document.getElementById("newwalletview").classList.remove('hide');
        // Hide the loader afterwards
        document.getElementById("beaneater").classList.add('hide');
        //document.getElementById("newWalletView").style.display = "inline";
      }

    }); // END CONTENT LOADED LISTENER

    // GENERAL CUSTOM FUNCTIONS
    
        // async function to create a new wallet
      async function createNewWallet() {
        
        // Use promises? 
        //     return new Promise(async (resolve, reject) => {
        // set the derivation path, DEFAULT now being the standard HD wallet that most other wallets use - "m/44'/145'/0'/0/0;
        const derivation = "m/44'/145'/0'/0/0";
        // ISSUE - default derivation is "m/44'/0'/0'/0/0"
        // ** WHEN CREATING A NEW WALLET, I'LL NEED TO CREATE ONE, THEN USE THAT SEED TO CREATE A NEW ONE WITH THE CORRECT DERIVATION
        // use the userid to create wallet1, then use that seed to create wallet with proper derivation.
        const wallet1 = await Wallet.named(userid);

        const seed = wallet1.mnemonic;
        // const derivationPath = "m/44'/145'/0'/0/0";
        // Create user wallet using supplied seed & derivation path.
        const walletId = 'seed:mainnet:' + seed + ':' + derivation;
        // Save the walletId for later use - 
        localStorage.setItem("walletId", walletId);
        // Load/create the wallet.
        const wallet = await Wallet.replaceNamed(userid, walletId);

        // Get Wallet Balance
        wallet.balance = await wallet.getBalance();
        
        // Get all UTXOs for wallet. Use this to provide UTXO selection to wallet via datatable
        wallet.utxos = await wallet.getUtxos();

        // Load the wallet
        loadWallet(wallet);
      }
        


     // function to import a wallet using a 12 word mnemonic seed phrase & derivation path.
     async function importWallet() {
        // grab selected derivation path 
        const d = document.getElementById('derivationPath');
        var derivation = d.options[d.selectedIndex].value;
        // grab user entered seed phrase
        const seed = document.getElementById('enterSeedphrase').value.trim();
        // Create user wallet using supplied seed & derivation path.
        const walletId = 'seed:mainnet:' + seed + ':' + derivation;
        // Save the walletId for later use - 
        localStorage.setItem("walletId", walletId);
        // Create the wallet.
        const wallet = await Wallet.replaceNamed(userid, walletId);

        // Get Wallet Balance
        wallet.balance = await wallet.getBalance();
        // Get all UTXOs for wallet. Use this to provide UTXO selection to wallet via datatable
        wallet.utxos = await wallet.getUtxos();
        // Load the wallet
        loadWallet(wallet);
        }

        // function to load the wallet
    async function loadWallet(wallet) {
        // Show the wallet details
        document.getElementById("walletexists").classList.remove('hide');
        // Hide the new wallet view
        document.getElementById("newwalletview").classList.add('hide');
        document.getElementById("beaneater").classList.add('hide');
        // Check persistent theme dark/light mode from IndexedDB.
        const userPrefersDark = localStorage.getItem("theme") === "dark";
        
        if(userPrefersDark){
        // click the button to trigger d4rk mode if user Prefers D4rk
          document.getElementById('darkmode').click();
        }
        
        console.log('Mainnet BCH wallet has been created... ', wallet);
        localStorage.setItem("isnew", "false");

        // TODO: Make Heirarchical Derivation (HD node) - using new addresses for each new utxo. 
        // Using default Electron-Cash "BIP39" Derivation Path to make importing to ElectronCash easier, not Bitcoin.com's multi-coin wallet.
        // const wallet = await Wallet.fromSeed(wallet1.mnemonic, "m/44'/145'/0'/0/0");
        
        if( wallet.derivationPath !== "m/44'/145'/0'/0/0"){
          console.log('Wallet is NOT using BIP39 Derivation path');
        }else{
          console.log('Wallet IS using BIP39 Derivation path');
        }
        
        // TODO: add functionality to allow user to restore from seed phrase, or WIF private key.
        // const wallet = await Wallet.fromSeed("horse duck stapler...", "m/44'/1'/145'/0/0");
        //const wallet = await Wallet.fromWIF('.....');
        // wallet.privateKeyWif
        // wallet.mnemonic
        // wallet.derivationPath
        
        // Get current wallet Derivation path and display for user.
        let derPath = wallet.derivationPath;
        console.log('DERIVATION PATH FOR WALLET = ' + derPath);
        document.getElementById("derivation").innerHTML = derPath;
        document.getElementById("derivation1").innerHTML = derPath;
        
        // DEBUG console.log('all wallet UTXOs = ' + JSON.stringify(wallet.utxos, null, 4));
        console.log('Hydrating UTXO Table...');
        
        //set utxo length
        document.getElementById("utxoLen").innerHTML = US.format(wallet.utxos.length) + ' ';
        
        // Fill in Datatable with UTXO hydration.
        var tbody = document.getElementById('tbody');

        // TODO: Make it load the Datatabes ONLY AFTER the for loop has finished loading all utxos (currently using jQuery to do this after 3 seconds but it needs to only do it after it has finished.

        //    var tr1 = "<thead><tr><th scope='col'>TxID</th><th scope='col'>Satoshis</th><th scope='col'>Height</th><th scope='col'>Status</th></tr></thead>";
        //   tbody.innerHTML = tr1;
        
        for (var i = 0; i < wallet.utxos.length; i++) {
            
            let confirmed = "<i class='bi bi-info-circle me-1'></i> Pending";
            let bgclass = 'badge bg-warning';
            let txid = wallet.utxos[i].txid;
            let vout = wallet.utxos[i].vout;
            let satoshis = wallet.utxos[i].satoshis;
            let height = wallet.utxos[i].height;
            if(height > 0){
              confirmed = "<i class='bi bi-check-circle me-1'></i> Confirmed";
              bgclass = 'badge bg-success';
              
            }
            
            // Start of Each Row
            var tr = "<tr><td><input class='coinsum' type='checkbox' value='" + satoshis +  "' name='" + txid + ":" + vout + "'></td>";
            // onClick='calculateSendTotal()'></td>";
            
            //Add in link for txid to blockchair BCH block explorer.
            let txHashURL = '<a href="https://blockchair.com/bitcoin-cash/transaction/' + txid + '" target="_blank">' + txid + '</a>'

            
            // Create table rows for data
            tr += "<td><span style='font-size=10pt;'>" + txHashURL + "</span></td><td>" + US.format(satoshis) + "</td><td>" + US.format(height) + "</td><td class='" + bgclass  + "'>" + confirmed + "</td></tr>";
            
            // Must not forget the $ sign */
            //tr += "<td>" + obj[i].key + "</td>" + "<td>$" + obj[i].value.toString() + "</td></tr>";

            // We add the table row to the table body */
            tbody.innerHTML += tr;
        } // END DataTable UTXO HYDRATION


        // TODO: Create separate page for Point of Sale (PoS) system/functionality. Then use the below to essentially pause everything to wait for
        // the TX. *SEND INFO FOR THE (newly generated) ADDRESS & AMOUNT to another page with just the address & amount, which also gives a SUCCESS MSG.


        //You can also wait for a wallet transaction and halt the program execution until it arrives:

        //const options = {
          //getTransactionInfo: true,
          //getBalance: false,
          //txHash: undefined
        //}
        //const response = await wallet.waitForTransaction(options);


        //  Get USD price of 1 BCH to display using the built-in price-getter from mainnet.cash library
        // TODO: Add a dropdown to select the currency and then save that preference in localStorage.getItem('currency'); Default: USD
        let bchPrice = await convert(1, "bch", "usd");
        if(bchPrice){ 
          document.getElementById("bchprice").innerHTML = bchPrice;
          thebchPrice = bchPrice;
        }

      // MAINNET WALLET LOGIC to run only after wallet has been loaded/created.
      if(wallet){
        let notifLength = 0;

        // Display all balance info - BCH, USD & SATS
        document.getElementById('bal').innerHTML = wallet.balance.bch + ' BCH';
        document.getElementById('balusd').innerHTML = US.format(wallet.balance.usd);
        document.getElementById('sats').innerHTML = US.format(wallet.balance.sat);
        // Get Network Info and Splice to Uppercase.
        let network = wallet.network;
        wallet.network = network.charAt(0).toUpperCase() + network.slice(1);
        
       // console.log('wallet.getDepositAddress() = ' + wallet.getDepositAddress());
        
        // Add Deposit Addr QR code to HTML.
        document.querySelector('#depositqr').src = wallet.getDepositQr().src;
        
        // TODO: Use pubx key to generate addresses for Point of Sale page. This page could auto-generate new addresses each time funds are received. It could also send any funds recieved back to the main wallet "receive" address so they aren't lost.
        // Use derivation path to get PubKeys to create additional recieve addresses (if needed?)
        //await wallet.getXPubKeys();
      
        // // use PubKeys to get more Addresses and then add to HTML
        // let addresses = await Mainnet.getAddrsByXpubKey(wallet.parentXPubKey,"0/0",5);
        // // console.log('adresses = ', addresses);

        // let addressesHTML;
        // let x = 0;

        // addresses.forEach( function(address){
        //   console.log(' address = ', address);
        //   if( address && x > 0){
        //     if(x == 1){
        //       addressesHTML = address + '<br />';

        //     }else{
        //       addressesHTML += address + '<br />';
        //     }
        //   }
        //   x++;
        // })
        // document.getElementById("addresses").innerHTML = addressesHTML;
        
        // Add Wallet Cash Address to HTML
        document.getElementById("cashaddr").innerHTML = wallet.cashaddr + '  <img id="copytext" width="15px" src="assets/img/copytext.jpg" onClick="copyText()">';
        document.getElementById("cashaddr2").innerHTML = wallet.cashaddr;
        // Add Mnemonic and Network to HTML
        document.getElementById("mnemonic").innerHTML = wallet.mnemonic;      
        document.getElementById("network").innerHTML = wallet.network;
        
       // Watch Main Deposit Addr for any new incoming transactions // If it isn't working then the websocket connections to the spv nodes 
       // probably timed out. Refresh the page to get new connections. 
       console.log('Watching address for new transactions');

      // wallet.watchAddress((txHash) => {
      
      wallet.watchAddressTransactions((tx) => {
    
          let txString = JSON.stringify(tx, null, 4); 

          console.log('New Transaction recieved. TX Details = ' + txString);
          // Should watch only for INCOMING TXs.

          let txHash = tx.txid;

          // Get all outputs
          let outputs = tx.vout;

          outputs.forEach(o => {
            // if the output wallet address matches this wallet, it's a BINGO!
            o.scriptPubKey.addresses.forEach(a => {
              if(a === wallet.address){
              // You have received vout.value BCH
              // TODO: add USD value based on current price.
              // let bchPrice = document.getElementById("bchprice").innerHTML
                let usdval = o.value * bchPrice;
                document.getElementById('txouts').innerHTML = '<span style="font-size:15pt;">' + o.value + ' BCH Received ($' + usdval + ').</span>';
              }
            })
          })


          // window.alert('New unspent transaction output recieved. TX HASH = ' + txHash)
          
          // Wallet does not detect utxos on addresses generated, other than the first, or main deposit address.
          
          // Get wallet Derivation path
          //let derPath = wallet.derivationPath;
          //console.log('DERIVATION PATH FOR WALLET = ' + derPath);
        
          // User derivation path to get PubKeys
          // await wallet.getXPubKeys()
        
          // use PubKeys to get more Addrs
          // await Mainnet.getAddrsByXpubKey("tpubDDfazrbXYF84Xxq7XqnakjAwVyCFVUGEWrsuQY3VqzpV8QgH2X2cczoZbEAyMdRmcra4nLhf67vEZ1jSnQ2KKcq5USoTGtFGaVTsXx7XsG7","0/0",5)


          // Create NOTIFICATION for new address displayed in top right of screen
          createNotif(txHash);


          //Show the UtxoModal & refresh bal when it is closed by user
          document.getElementById('modalbtn').click();

       }); // End wallet.watchAddressTransactions((tx) => {

      // never cancelWatch. Always keep Watching as long as page is open

      // const cancelWatch = wallet.watchAddressTransactions((tx) => {
      //     if (tx.hash === someHash) {
      //       cancelWatch();
      //     }
      // });


          // Get wallet Derivation path
          //let derPath = wallet.derivationPath;
          //console.log('DERIVATION PATH FOR WALLET = ' + derPath);
        
          // User derivation path to get PubKeys
          // await wallet.getXPubKeys()
        
          // use PubKeys to get more Addrs
          // await Mainnet.getAddrsByXpubKey("tpubDDfazrbXYF84Xxq7XqnakjAwVyCFVUGEWrsuQY3VqzpV8QgH2X2cczoZbEAyMdRmcra4nLhf67vEZ1jSnQ2KKcq5USoTGtFGaVTsXx7XsG7","0/0",5)

        } // END if(wallet){}

    } // End loadWallet(wallet)
    
    // Function to add event listener to SEND FORM for MANUAL bch amount changes - to then update the USD value being sent. This would allow the USD to track manual changes to send bal made by user.
    // This is broken because it interferes with the current checkbox change refresh // Might come back to it.
    //var sendTitleInput = document.getElementById('send-total');
    //sendTitleInput.addEventListener("change", function(){
      ////TODO: recalcuate the USD value and then set that.
        //var totalUsd = document.getElementById('send-totalusd'),
        //totalToSend = sendTitleInput.value,
        //totalUsdVal = US.format(totalToSend * thebchPrice);
        //// Showing user the totals
        //totalUsd.innerHTML = totalUsdVal;
        //// Debug console log
        //console.log('total.value = '+ total.value);
								
      //});

    // FUNCTION TO WATCH UTXO CHECKBOXES AND RE-CALC TOTALS BASED ON INPUT CHANGES
 //  function calculateSendTotal() {
  setTimeout( function(){  
   // console.log('watching utxo checkboxes...'); 
      var inputs = document.getElementsByClassName('coinsum'),
      total  = document.getElementById('send-total'),
      totalUsd = document.getElementById('send-totalusd');
      
      // when sendmax checkbox is checked, select all coinsum inputs.
      var inputMax = document.getElementById('sendmax');
      inputMax.onchange = function() {


        for (var i=0; i < inputs.length; i++) {
          console.log('Input ' + i + '. input.checked = ' + inputs[i].checked);
							      
          if(inputMax.checked === true){
            // first reset send-total to 0, in case user entered custom amounts.
           // total.value = 0;
          
          // if it's not already selected, click the checkbox.
            if(inputs[i].checked === false){
              inputs[i].click();
            }
          }else{
            // inputMax was unselected.
            // if it's IS already selected, click the checkbox to unselect.
            if(inputs[i].checked === true){
              inputs[i].click();
            }
          }
        } // END SENDMAX FOR
      }
      
      //console.log('INPUTS.length = ' + inputs.length);
							
      for (var i=0; i < inputs.length; i++) {
        // Everytime one of the checkboxes are changed (clicked/unclicked) this funtion is run. 
        // ISSUE: For some reason, after modal close and balance refresh function runs successfully, this no longer works to monitor input checkboxes.
        // TODO: Test out methods of onclick or onchange or oninput. Right now this is nested inside of a timeout func.
        inputs[i].onchange = function() {            
            // Inputs changed, one was selected or de-selected. 
            
            // First reset send-total to 0, just in case the user entered a custom amount.
            // Only do this if it's been selected, not  de-selected.
          //  if(this.checked){
          //   total.value = 0;
          //  }
            // Recaclulating totals
            var checkedUtxosArray = new Array();
            console.log('inputs have changed, caclulating coinsum totals ');
            var add = this.value * (this.checked ? 1 : -1);
            // Convert add (in satoshis) to BCH
            add = (add / 100000000)
            
            //add.toFixed(8)
            console.log('add = ' + add);
            var totalValue = (parseFloat(total.value) + add).toFixed(8);
           // send-total-amount.value = totalValue;
            total.value = totalValue;
            
            //TODO: move bchPrice grab to here to always get latest price. Currently using price that was generated on page load.
            var totalUsdVal = US.format(total.value * thebchPrice)
            // Showing user the totals
            totalUsd.innerHTML = totalUsdVal;
            // Debug console log
            console.log('total.value = '+ total.value);
								
            // TODO: Create a separate array of TXIDs and add this info into the SEND FORM!!! *****
            
            
           // var sendTxidList = document.getElementsByClassName('txidsum');
          }
        }
      }, 5000);
    
    // Function to allow user to Delete their bitcoincash wallet (and start anew). For some reason, it says it fails to delete, but it actually does delete it.
    // TODO: Should force a reload of the page after delete so user doesn't accidentally send coins to old wallet.
    function deleteWallet() {

      let databaseName = "bitcoincash";

        // TODO: first warn user about deleting wallet & ask them to back up seed phrase.
        
        if (confirm('Are you sure you want to DELETE THIS BITCOIN CASH WALLET? This cannot be undone. You will be prompted to create a new wallet, or restore an existing one. Make sure to save the Mnemonic seed phrase and Derivation first!')) {
          // Save it!
          var req = indexedDB.deleteDatabase(databaseName);
          req.onsuccess = function () {
              console.log("Deleted Bitcoin Cash wallet successfully.");
              alert('Deleted Bitcoin Cash wallet successfully. Please reload the page (Ctrl + R) to create a new wallet. DO NOT SEND BCH to this current wallet unless you have backed up your mnemonic seed phrase.');
              location.reload(true);
            };
          req.onerror = function () {
              console.log("Couldn't delete database for BCH wallet.");
              alert("Error... but it still probably deleted the wallet. You should refresh the page!");
              location.reload(true);
            };
          req.onblocked = function () {
              console.log("Couldn't delete database for BCH wallet due to the operation being blocked. It probably deleted it anyways though.");
              alert("Couldn't delete database for BCH wallet due to the operation being blocked.");
              location.reload(true);
            };
          
        } else {
          // Do nothing!
          console.log('Wallet was not deleted; user cancelled');
        }
    }

    // Where el is the DOM element you'd like to test for visibility
    function isHidden(el) {
        return (el.offsetParent === null)
    }

    // *** Function to SEND BCH ***
    // #
    // # https://mainnet.cash/tutorial/#sending-money
    // #
    
    // TODO: Add in a NULL check for send-Total
    async function sendBCH() {

      console.log('SendBCH function kicked off...');

      // Check for errors upfront and return error if exists.
      console.log('checking for invalid feedback..');
      var invalidInputs = document.getElementsByClassName("invalid-feedback");
      var thereareerrors = false;

        for (var i=0; i < invalidInputs.length; i++) {

          if(!isHidden(invalidInputs[i])) {
            thereareerrors = true;
          }
        }
        
        // Null check
        if (document.getElementById("send-total").value < 0.00000001){
          console.log('User is trying to send value less than 0.00000001');
          thereareerrors = true;
        }

        console.log('Are there errors? ' + thereareerrors);

      if(thereareerrors == false){
        // there are no errors, proceed with SEND
        console.log('There are no errors, proceeding with send');

        // Show loader GIF
        document.getElementById("loader").style.display = "inline";

          // Get variables for sending, trim whitespace on sendtoAddr. 
          let sendToAddr = document.getElementById("sendtoaddress").value.trim();
          let sendTotal = document.getElementById("send-total").value;
          let sendMax = document.getElementById("sendmax");

          console.log('SendMax is checked? ' + sendMax.checked);
          
          // Creates new/loads existing MAINNET WALLET STORED IN USER BROWSER, referenced by userid set here. 
          const wallet = await Wallet.named(userid);

          // if Sendmax was checked, lets just send all funds to specified address.
          if(sendMax.checked){
            console.log('SendMax was checked. Sending all funds to address provided.');

            try{

              const txData = await wallet.sendMax(sendToAddr);
              console.log(txData);

              // if it returns a successful txData obj, lets pass this info back to HTML
              if(txData){
                // add to HTML
                console.log('txData = ' + txData);
                let txHash = txData.txId;
                
                let txDataHTML = 'Transaction sent successfully. <br />Tx Hash => <a href="https://blockchair.com/bitcoin-cash/transaction/' + txHash + '" target="_blank">' + txHash + '</a>. <br /><br />';
                
                let txDataSpan = document.getElementById("txdata");
                txDataSpan.style.display = "inline";
                txDataSpan.innerHTML = txDataHTML;

                // Hide loader GIF
                document.getElementById("loader").style.display = "none";

                // Display all balance info with the returned balance - BCH, USD & SATS
                document.getElementById('bal').innerHTML = txData.balance.bch + ' BCH';
                document.getElementById('balusd').innerHTML = US.format(txData.balance.usd);
                document.getElementById('sats').innerHTML = US.format(txData.balance.sat);

                // Reset the BCH Send Form
                resetSendBCHform();
                
              }

            }catch(error){
              // set error message in HTML
              error = '<br />' + error;
              document.getElementById('send-error').innerHTML = error;

              // Hide the loader GIF again
              document.getElementById("loader").style.display = "none";
            }


          }else{ //sendMax wasn't checked. Either UTXO selection or Custom amount.
            console.log('SendMax wasnt checked. Checking for utxo selections.');

            //get utxo selection info
            console.log('Getting utxo selection info from coinsum inputs');
            var inputs = document.getElementsByClassName('coinsum');
            let inputArray = new Array();

            for (var i=0; i < inputs.length; i++) {
              // if input is selected/checked, add it to our send inputArray
              if(inputs[i].checked){
                inputArray.push(inputs[i].name);
              }
            }


            // subtract a standard fee amnt from total so that the change can be used
     //       let fees = 0.00000361;
     //       sendTotal -= fees;

            var sendRequestOptions;
            
            // Check if any utxo inputs (checkboxes) have been selected to be sent
            if(inputArray.length > 0){
              console.log('inputArray of selected utxos exists, sending with utxo selection...');
              console.log('selected inputArray = ' + inputArray);
              // Use sendRequestOptions with selection utxo array and fees paid by the change
              sendRequestOptions = { utxoIds: inputArray }; //, feePaidBy: "change"
            }

            if(sendRequestOptions){
              console.log('sendRequestOptions is not NULL. This means there are custom params for the send (utxo selections)');
              // TODO: I could try doing the advanced way to see if that works better?
              // const encodedTransaction = await wallet.encodeTransaction(
              //  // requests, // send requests as in `send` method
              //   false, // discard change
              //   sendRequestOptions // options as described above
              // );

              // const txId = await wallet.submitTransaction(
              //   encodedTransaction,
              //   awaitTransactionPropagation // as in options.awaitTransactionPropagation
              // );


                

              // clear any existing errors
              document.getElementById('send-error').innerHTML = null;

              try{
  
                // Functioning METHOD OF SENDING WITH SENDMAX - LIMITED TO ONLY THE SELECTED UTXOs.
                const txData = await wallet.sendMax(sendToAddr, sendRequestOptions);

                // if it returns a successful txData obj, lets pass this info back to HTML
                if(txData){
                  // add to HTML
                  console.log('TX SUCCESSFUL. txData = ' + txData);
                  let txHash = txData.txId;

                  let txDataHTML = 'Transaction sent successfully. <br />Tx Hash => <a href="https://blockchair.com/bitcoin-cash/transaction/' + txHash + '" target="_blank">' + txHash + '</a>. <br /><br />';

                  let txDataSpan = document.getElementById("txdata");
                  txDataSpan.innerHTML = txDataHTML;
                  txDataSpan.style.display = "block";
                  // TODO: Create a Modal or alert for notification of tx sent info.

                  // Hide loader GIF
                  document.getElementById("loader").style.display = "none";

                  // Display all balance info with the returned balance - BCH, USD & SATS
                  document.getElementById('bal').innerHTML = txData.balance.bch + ' BCH';
                  document.getElementById('balusd').innerHTML = US.format(txData.balance.usd);
                  document.getElementById('sats').innerHTML = US.format(txData.balance.sat);

                  // Reset the BCH Send Form
                  resetSendBCHform();
                }

              }catch(error){
              // set error in HTML
              error = '<br />' + error;
              document.getElementById('send-error').innerHTML = error;

              // Hide loader GIF
              document.getElementById("loader").style.display = "none";
            }



            }else{
              console.log('SendRequestOptions is NULL. This means there was no utxo selection. This could mean they manually entered an amount to send (in BCH).');
              
              // clear any errors
              document.getElementById('send-error').innerHTML = null;

              try {
                  console.log('continuing with a ( SIMPLE SEND / Custom Amount Send ) of ' + Number(sendTotal) + ' to ' + sendToAddr + '.');
                  // SIMPLE SEND with just an address and the custom amount in BCH.
                 const txData = await wallet.send([
                  {
                    cashaddr: sendToAddr,
                    value: Number(sendTotal),
                    unit: 'bch'
                  //  sendRequestOptions
                  }
                ]); // end txData

                // if it returns a successful txData obj, lets pass this on to the user
                if(txData){
                  // add to HTML
                  console.log('txData = ' + txData);
                  let txHash = txData.txId;

                  let txDataHTML = 'Transaction sent successfully. <br />Tx Hash => <a href="https://blockchair.com/bitcoin-cash/transaction/' + txHash + '" target="_blank">' + txHash + '</a>. <br /><br />';

                  let txDataSpan = document.getElementById("txdata");
                  txDataSpan.innerHTML = txDataHTML;
                  // TODO: Create a Modal for notification of this info.

                  // Hide loader GIF
                  document.getElementById("loader").style.display = "none";

                  // Display all balance info with the returned balance - BCH, USD & SATS
                  document.getElementById('bal').innerHTML = txData.balance.bch + ' BCH';
                  document.getElementById('balusd').innerHTML = US.format(txData.balance.usd);
                  document.getElementById('sats').innerHTML = US.format(txData.balance.sat);

                  // Reset the BCH Send Form
                  resetSendBCHform();

                } // end if(txData)

              }catch(error){ // catch send error
                // set error in HTML
                error = '<br />' + error;
                document.getElementById('send-error').innerHTML = error;

                // Hide loader GIF
                document.getElementById("loader").style.display = "none";

              }

            } // end else (no utxo selection send)
          } // End else for SendMax

        }else{ // there are errors. Tell user to fix the errors.

              document.getElementById('send-error').innerHTML = '<br />Please fix the errors.';

        } // END IF THEREAREERRORS = FALSE;

    }
    
    // Date function
  function loadDate(){
    const d = new Date();
    const formattedDate = d.toLocaleString("en-US", {
      day: "numeric",
      month: "short",
      year: "numeric",
      hour: "numeric",
      minute: "2-digit"
    });
    console.log('Date: ' + formattedDate);
    document.getElementById('thedate').innerHTML = '' + formattedDate;
  }
  
    // Custom function to enable/disable dark mode
    // TODO: REDO ALL OF THIS to do it correctly; this is some bad h4cks
    function toggleDarkMode() {
      console.log('Toggling D4RK mode');
      let currentBackground = document.getElementById('main').style.background;
      // already D4RK?
      if(currentBackground === "black"){
        // make it LIGHT
        document.getElementById('main').style.background = "none";
        document.getElementById('header').style.background = "white";
        document.getElementById('footer').style.background = "white";
        document.getElementById('sidebar').style.background = "white";
        document.getElementById('utxoTable').tHead.style.background = "none";
        document.getElementById('thehtml').style.background = "white";
        //user prefers light mode;
        localStorage.setItem("theme", "light");
          //document.html.style.color = "white !important;"
          
          var sideClasses = document.getElementsByClassName("sidebar");
        let sidebar = sideClasses[0]
        sidebar.style.background = "white";
        
        var cardbodys = document.getElementsByClassName("card-body");
          for (var i=0; i < cardbodys.length; i++) {
            cardbodys[i].style.background = "white";
          }
          
          var infoCards = document.getElementsByClassName("info-card");
          for (var i=0; i < infoCards.length; i++) {
            infoCards[i].style.background = "white";
          }
          
          var cardicons = document.getElementsByClassName("card-icon");
          for (var i=0; i < cardicons.length; i++) {
            cardicons[i].style.background = "white";
          }
          
        var navLinks = document.getElementsByClassName("nav-link");
          for (var i=0; i < navLinks.length; i++) {
            navLinks[i].style.background = "white";
          }
          
                    
        var modals = document.getElementsByClassName("modal-content");
          for (var i=0; i < modals.length; i++) {
            modals[i].style.background = "white";
          }
                                          
        var accordians = document.getElementsByClassName("accordion-item");
          for (var i=0; i < accordians.length; i++) {
            accordians[i].style.background = "white";
          }
          
        var dropdowns = document.getElementsByClassName("dropdown-menu");
          for (var i=0; i < dropdowns.length; i++) {
            dropdowns[i].style.background = "white";
          }
          
          // make text BL4CK
          var all = document.getElementsByTagName("*");

          for (var i=0, max=all.length; i < max; i++) {
           all[i].style.color = "black";
          }
          
          document.getElementById('faq-modal').style.background = "white";
          
        var accordianButtons = document.getElementsByClassName("accordion-button");
          for (var i=0; i < accordianButtons.length; i++) {
            accordianButtons[i].style.color = "black";
          }
          
          // Color links again
          colorLinks("#989898"); 
          
          // make BCH price green again
          document.getElementById('bchprice').style.color = "#198754"
          
      }else{
          // It is Light, we must..
          // make it D4RK!
        document.getElementById('main').style.background = "black";
        document.getElementById('header').style.background = "black";
        document.getElementById('footer').style.background = "black";
        document.getElementById('sidebar').style.background = "black";
        document.getElementById('thehtml').style.background = "black";

        // make utxo table head dark
        document.getElementById("utxoTable").tHead.style.background = "black";

        // user prefers D4RK mode
        localStorage.setItem("theme", "dark");

        //document.getElementById('main').style.background = "black";
        var sideClasses = document.getElementsByClassName("sidebar");
        let sidebar = sideClasses[0]
        sidebar.style.background = "black";
        
        var cardbodys = document.getElementsByClassName("card-body");
          for (var i=0; i < cardbodys.length; i++) {
            cardbodys[i].style.background = "#5b5b5b";
          }
          
        var infoCards = document.getElementsByClassName("info-card");
          for (var i=0; i < infoCards.length; i++) {
            infoCards[i].style.background = "#5b5b5b";
          }
          
        var cardicons = document.getElementsByClassName("card-icon");
          for (var i=0; i < cardicons.length; i++) {
            cardicons[i].style.background = "black";
          }
          

        var navLinks = document.getElementsByClassName("nav-link");
          for (var i=0; i < navLinks.length; i++) {
            navLinks[i].style.background = "black";
          }
          
        var modals = document.getElementsByClassName("modal-content");
          for (var i=0; i < modals.length; i++) {
            modals[i].style.background = "black";
          }
          
                    
        var accordians = document.getElementsByClassName("accordion-item");
          for (var i=0; i < accordians.length; i++) {
            accordians[i].style.background = "black";
          }
          
        var dropdowns = document.getElementsByClassName("dropdown-menu");
          for (var i=0; i < dropdowns.length; i++) {
            dropdowns[i].style.background = "black";
          }
          
          
          
          
          document.getElementById('faq-modal').style.background = "black";
          
        var accordianButtons = document.getElementsByClassName("accordion-button");
          for (var i=0; i < accordianButtons.length; i++) {
            accordianButtons[i].style.color = "white";
          }

          // make all text white globally
          var all = document.getElementsByTagName("*");

          for (var i=0, max=all.length; i < max; i++) {
            
           all[i].style.color = "white";
          }
          
          // Make sure our inputs are all black
          document.getElementById("sendtoaddress").style.color = "black";
          document.getElementById("send-total").style.color = "black";
          document.getElementById("signverifymessage").style.color = "black";
          document.getElementById("signaturetoverify").style.color = "black";
          
          
          var allElements = document.getElementsByTagName('label');
          for (var i = 0, n = allElements.length; i < n; i++)
          {
            allElements[i].style.color = "grey";
          }
          var feedbacks = document.getElementsByClassName("invalid-feedback");
          for (var i=0; i < feedbacks.length; i++) {
            feedbacks[i].style.color = "#ff6d6d";
          }
          
          // Color Links again
          colorLinks("#989898");      
          
          // make BCH price green again
          document.getElementById('bchprice').style.color = "#198754"; 

          // color in fake buttons again
          var buttonprimary = document.getElementsByClassName("button");
          for (var i=0; i < buttonprimary.length; i++) {
            buttonprimary[i].style.color = "black";
          }

          // color in mnemonic text box and derivation selector
          document.getElementById("enterSeedphrase").style.color = "black";
          document.getElementById("derivationPath").style.color = "black";
      }
    }
    
  // color links with javascript
function colorLinks(hex)
          {
              var links = document.getElementsByTagName("a");
              for(var i=0;i<links.length;i++)
              {
                  if(links[i].href)
                  {
                      links[i].style.color = hex;  
                  }
              }  
          }

    
    // show hidden mnemonic button
    function showMnemonic() {
      console.log('showing mnemonic');
      document.getElementById("mnemonic").style.all = "initial";
      document.getElementById("lock-open").style.display = "inline";
      document.getElementById("lock").style.display = "none";

      //show the hide button
      document.getElementById("hideMnemonicMenu").style.display = "inline";
      document.getElementById("showMnemonicMenu").style.display = "none";

      // filter: blur(50%);
    }

    // show hidden mnemonic button
    function hideMnemonic() {
      console.log('hiding mnemonic');
      document.getElementById("mnemonic").style = "filter: blur(50%);color: transparent;text-shadow: 0 0 5px rgba(0,0,0,0.5);";
      document.getElementById("lock-open").style.display = "none";
      document.getElementById("lock").style.display = "inline";

      //show the hide button
      document.getElementById("showMnemonicMenu").style.display = "inline";
      document.getElementById("hideMnemonicMenu").style.display = "none";

      // filter: blur(50%);
    }

    function hideMnemonicTab(){ 
      document.getElementById("theMnemonic").style.display = "none" 
    }

    function showMnemonicTab(){ 
      document.getElementById("theMnemonic").style.display = "inline" 
    }
    

    // RUN THIS IF THE MODAL IS CLOSED IN ANY WAY. (Not just the "Close" button)
    async function reloadBal() {
      console.log('Reload Balance (& UTXOs) func kicked off...');

      // Get variables for sending and reset all values.
      let sendToAddr = document.getElementById("sendtoaddress").value;
      let sendTotal = document.getElementById("send-total").value;
      let sendMax = document.getElementById("sendmax");

      sendToAddr = null;
      sendTotal = null;
      sendMax.checked = false;

      // Creates new/loads existing MAINNET WALLET STORED IN USER BROWSER, referenced by userid set here. 
      const wallet = await Wallet.named(userid);
      wallet.balance = await wallet.getBalance();

        // Display all balance info - BCH, USD & SATS
        document.getElementById('bal').innerHTML = wallet.balance.bch + ' BCH';
        document.getElementById('balusd').innerHTML = US.format(wallet.balance.usd);
        document.getElementById('sats').innerHTML = US.format(wallet.balance.sat);

      // After Balance Reload, also reload UTXOs
      // Get all UTXOs for wallet. Use this to add UTXO selection to wallet. ** CREATE DATA TABLE WITH THIS INFO.
      wallet.utxos = await wallet.getUtxos();
      // DEBUG console.log('all wallet UTXOs = ' + JSON.stringify(wallet.utxos, null, 4));
        console.log('RE-Hydrating UTXO Table...');
        
        //set utxo length
        document.getElementById("utxoLen").innerHTML = US.format(wallet.utxos.length) + ' ';
        
         // Hydrate Datatable with UTXO data.
        var tbody = document.getElementById('tbody');
        // trying to clear the table first.
        for(var i = 0;i<tbody.rows.length;){
            tbody.deleteRow(i);
        }

       // var tr1 = "";
      //  tbody.innerHTML = tr1;
        
        for (var i = 0; i < wallet.utxos.length; i++) {
          //  var tr = "<tr>";
  
            let confirmed = "Pending";
            let bgclass = 'badge bg-warning';
            let txid = wallet.utxos[i].txid;
            let satoshis = wallet.utxos[i].satoshis;
            let vout = wallet.utxos[i].vout;
            let height = wallet.utxos[i].height;
            if(height > 0){
              confirmed = "Confirmed";
              bgclass = 'badge bg-success';
            }
            
            // Start of Each Row
            var tr = "<tr><td><input class='coinsum' type='checkbox' value='" + satoshis +  "' name='" + txid + ":" + vout + "'></td>";                       
            //Add in link for txid to block explorer... or to nodebox?
            let txHashURL = '<a href="https://blockchair.com/bitcoin-cash/transaction/' + txid + '" target="_blank">' + txid + '</a>'

            // Create table rows for data
            tr += "<td><span style='font-size=10pt;'>" + txHashURL + "</span></td><td>" + US.format(satoshis) + "</td><td>" + US.format(height) + "</td><td class='" + bgclass  + "'>" + confirmed + "</td></tr>";

            // Must not forget the $ sign */
            //tr += "<td>" + obj[i].key + "</td>" + "<td>$" + obj[i].value.toString() + "</td></tr>";

            // We add the table row to the table body */
            tbody.innerHTML += tr;
        }

        // TODO: Figure out why the utxo selection STOPS working after the reloadBal() function is run !!!

    } // end reloadBal()

    function getNewDepositAddr() {
      // TODO: add this funcitonality when mainnet.js can scan/use other addresses for funds. Right now it's only the one address that you can (EASILY) send/recieve on.
    }
          // Create a NEW NOTIFICATION for any incoming transactions
          let notifLength2 = 0;
    function createNotif(txHash) {

          notifLength2++;

          document.getElementById('notifLength').innerHTML = notifLength2;
          document.getElementById('notifLength2').innerHTML = notifLength2;

          let notifications = 
          '<li class="notification-item"  style="overflow:scroll;"> <i class="bi bi-exclamation-circle text-warning"></i><div> <h4>New TX Detected!</h4> <p>TXID/Hash is ' + txHash + '</p> <p><a href="https://blockchair.com/bitcoin-cash/transaction/' + txHash + '" target="_blank">View in Explorer</a></p> </div> </li> <li> <hr class="dropdown-divider"> </li>';
          document.getElementById('notifications').innerHTML += notifications;
  

          let txHashURL = '<a href="https://blockchair.com/bitcoin-cash/transaction/' + txHash + '" target="_blank">' + txHash + '</a>'

          document.getElementById('txhash').innerHTML = txHashURL;


    }

    // click the faq button
    function faq() { document.getElementById('faqmodalbtn').click(); }
    
    // copy function
    function copyText() {
      let text = document.getElementById('cashaddr').innerText;
      console.log('text to copy is... ' + text);
      navigator.clipboard.writeText(text.trim());
      alert('The Deposit address was copied to clipboard.');
    }
    


  
  // Easy selector helper function
   
  const select = (el, all = false) => {
    el = el.trim()
    if (all) {
      return [...document.querySelectorAll(el)]
    } else {
      return document.querySelector(el)
    }
  }
  
    
   // Easy event listener function
  const on = (type, el, listener, all = false) => {
    if (all) {
      select(el, all).forEach(e => e.addEventListener(type, listener))
    } else {
      select(el, all).addEventListener(type, listener)
    }
  }

  
   // Easy on scroll event listener 
  const onscroll = (el, listener) => {
    el.addEventListener('scroll', listener)
  }
  
    // Sidebar Toggle
  if (select('.toggle-sidebar-btn')) {
    on('click', '.toggle-sidebar-btn', function(e) {
      select('body').classList.toggle('toggle-sidebar')
    })
  }
  
   // Search bar toggle
  if (select('.search-bar-toggle')) {
    on('click', '.search-bar-toggle', function(e) {
      select('.search-bar').classList.toggle('search-bar-show')
    })
  }


   //Navbar links active state on scroll
  let navbarlinks = select('#navbar .scrollto', true)
  const navbarlinksActive = () => {
    let position = window.scrollY + 200
    navbarlinks.forEach(navbarlink => {
      if (!navbarlink.hash) return
      let section = select(navbarlink.hash)
      if (!section) return
      if (position >= section.offsetTop && position <= (section.offsetTop + section.offsetHeight)) {
        navbarlink.classList.add('active')
      } else {
        navbarlink.classList.remove('active')
      }
    })
  }
  
  window.addEventListener('load', navbarlinksActive)
  onscroll(document, navbarlinksActive)
 
   //. Toggle .header-scrolled class to #header when page is scrolled
  let selectHeader = select('#header')
  if (selectHeader) {
    const headerScrolled = () => {
      if (window.scrollY > 100) {
        selectHeader.classList.add('header-scrolled')
      } else {
        selectHeader.classList.remove('header-scrolled')
      }
    }
    window.addEventListener('load', headerScrolled)
    onscroll(document, headerScrolled)
  }


   // Back to top button
  let backtotop = select('.back-to-top')
  if (backtotop) {
    const toggleBacktotop = () => {
      if (window.scrollY > 100) {
        backtotop.classList.add('active')
      } else {
        backtotop.classList.remove('active')
      }
    }
    window.addEventListener('load', toggleBacktotop)
    onscroll(document, toggleBacktotop)
  }
  
  function showVerifyBtn(){
    //console.log('onblur kicked off...');
    // triggered by user writing into input field.
    let signatureToVerify = document.getElementById("signaturetoverify").value;
        
    if(signatureToVerify.length !== 0){
      // Show the Verify btn & Hide the Sign btn
        document.getElementById("verifyBtn").style.display = "inline";
        document.getElementById("signBtn").style.display = "none";
      }else{
        // Show the Sign btn & Hide the Verify btn
        document.getElementById("verifyBtn").style.display = "none";
        document.getElementById("signBtn").style.display = "inline";
      }
  }

  function clearSendForm(){ 
    document.getElementById('sendbchform').reset();  
  }
  
  function clearVerifyForm(){ 
    document.getElementById('signverifyform').reset();  
  }
  
  
  async function signMessage(){
    // Get Form Data for signing message, trim whitespace. 
      let msg = document.getElementById("signverifymessage").value.trim();
      
    // Sign the Message (using the PRIVATE KEY and message) and return the newly created signature
  if(msg.length > 0){
        document.getElementById('signverifymsgerror').style.display = 'none';
      try {
        // Creates new/loads existing MAINNET WALLET STORED IN USER BROWSER, referenced by userid set here. 
        const wallet = await Wallet.named(userid);
        
        // Sign message using wallet
        const sigResult = await wallet.sign(msg);
        let signature = sigResult.signature;
        
        // Show the signature and other details for the user in an alert.
        window.alert('Message:\n   ' + msg + '\n \nBitcoin Cash Address:\n' + wallet.cashaddr + '\n \nSignature:\n' + signature);
        prompt("Copy to clipboard: Ctrl+C, Enter", signature);
        
        // Or show on the webpage..
        // document.getElementById("sigformessage").innerHTML = 'Message:<br />  ' + msg + '<br />Signed by Address:<br />  ' + wallet.cashaddr + '<br />Signature:<br />  ' + signature + '<br />';
        
      } catch (err) {
            console.error('Failed to SIGN message: ', err);
            window.alert('Failed to SIGN message: ' + err);
            // Show error to user
      }
    }else{
      // show message empty error to user
      document.getElementById('signverifymsgerror').style.display = 'inline';
    }

  }
  
  async function verifyMessage(){
    console.log('verifying message...');
    // Get Form Data
      let msg = document.getElementById("signverifymessage").value.trim();
      let sig = document.getElementById("signaturetoverify").value;

      console.log('msg = ' + msg);
      console.log('sig = ' + sig);
    // Creates new/loads existing MAINNET WALLET STORED IN USER BROWSER, referenced by userid set here. 
    const wallet = await Wallet.named(userid)
      
    // Verify the Message (using the Message & Signature) 
  if(msg.length > 0){
    document.getElementById('signverifymsgerror').style.display = 'none';
      try {
        verifyResult = await wallet.verify(msg, sig);
        window.alert('Valid:\n ' + verifyResult.valid + '\n \nMessage:\n  ' + msg + '\n \nBitcoin Cash Address:\n' + wallet.cashaddr + '\n \nSignature:\n' + sig);
            // Show the verification of the signature and other details for the user.

      } catch (err) {
            console.error('Failed to VERIFY message: ', err);
            window.alert('Failed to VERIFY message: ' + err);
            // Show error to user
      }
    }else{
      // show message empty error to user
      document.getElementById('signverifymsgerror').style.display = 'inline';
    }
  }
  
  
  // Function to calculate the USD total for the send-total input. If the send-total (BCH) input is changed, this function will be kicked
  // off to re-calc the USD totals.
 function calcUsd() {

    const filterNum = (str) => {
      const numericalChar = new Set([ ".",",","0","1","2","3","4","5","6","7","8","9" ]);
      str = str.split("").filter(char => numericalChar.has(char)).join("");
      return str;
  }
  
      total  = document.getElementById('send-total'),
      totalUsd = document.getElementById('send-totalusd'),
      bal = document.getElementById('bal');

      bal = filterNum(bal.innerHTML);
      console.log('balance = ' + bal);
      
            // Currently using price that was generated on page load.
            var totalUsdVal = US.format(total.value * thebchPrice);
            // Showing user the totals
            totalUsd.innerHTML = totalUsdVal;
            // Debug console log
    //        console.log('total.value = '+ total.value);
    
    // Check if the user entered send amount is more than user balance and show error if so.
    if( total.value > Number(bal)){
      console.log('user doesnt have enough funds');
      // show error
      document.getElementById('needfunds').style.display = 'inline';
    }else{
      // dont show error
      document.getElementById('needfunds').style.display = 'none';
    }
    
  }
  
  
  const copyTextOld = async () => {
    try {
      let text = document.getElementById('cashaddr').innerText;
      await navigator.clipboard.writeText(text);
      console.log('Bitcoin Cash address has been copied to clipboard');
    } catch (err) {
      console.error('Failed to copy BCH address: ', err);
    }
  }

// CUSTOM SCRIPT TO SAVE AS PDF - PAPER WALLET ON THE GO.
//function getPDF() {
    //var doc = new jsPDF();
    //doc.addHTML(document.body, function() {
        //doc.save('test.pdf')
    //})
// }

  </script>

  <script type="text/javascript">
    // TODO: KICK OFF FUNCTION ONLY AFTER UTXOs are HYDRATED, MOVE THIS TO THE NORMAL JS SECTION AND DONT USE JQUERY ***
    $(document).ready(function(){
      //jQuery
      // Intantiate utxo DataTable after 3 seconds to allow proper UTXO hydration
      setTimeout(function(){
        let table = new DataTable('#utxoTable');
        $(".dataTables_empty").css("display", "none");
      }, 2000);

    });


  </script>

</head>

<body>

  <!-- ======= Header ======= -->
  <header id="header" class="header fixed-top d-flex align-items-center">

    <div class="d-flex align-items-center justify-content-between">
      <a href="/" class="logo d-flex align-items-center">
        <img src="assets/img/logo.png" alt="">
        <span class="d-none d-lg-block">BCH Admin</span>
      </a>
      <i class="bi bi-list toggle-sidebar-btn"></i>
    </div><!-- End Logo -->


    <div class="search-bar">
      <span style="font-size:10pt;color:#899bbd;" id="thedate"></span>
    <!--  <form class="search-form d-flex align-items-center" method="POST" action="#">
        <input type="text" name="query" placeholder="Search" title="Enter search keyword">
        <button type="submit" title="Search"><i class="bi bi-search"></i></button> -->
        <script type="text/javascript">
         loadDate();
        </script>
      </form>
    </div> 

    <nav class="header-nav ms-auto">
      <ul class="d-flex align-items-center">

        <li class="nav-item dropdown" style="padding-right:20px">
          <label class="switch"> <span style="font-size:10pt"></span>
            <input id="darkmode" type="checkbox" onClick="toggleDarkMode()" title="Toggle Dark Mode" >
            <span class="slider"></span>
           </label>
           <!-- <i class="bi bi-search"></i> -->
          </a>
        </li><!-- End Search Icon-->

        <li class="nav-item dropdown">

          <a class="nav-link nav-icon" data-bs-toggle="dropdown">
            <i class="bi bi-bell"></i>
            <span id="notifLength" class="badge bg-primary badge-number">0</span>
          </a><!-- End Notification Icon  overflow-x: scroll;   -->
          <ul id="notifications" class="dropdown-menu dropdown-menu-end dropdown-menu-arrow notifications" style="word-wrap:break-word;" >
            <li class="dropdown-header">
              You have <span id="notifLength2" >0</span> new notifications
             <!-- <a href="#"><span class="badge rounded-pill bg-primary p-2 ms-2">View all</span></a> -->
            </li>
            <li>
              <hr class="dropdown-divider">
            </li>
          </ul><!-- End Notification Dropdown Items -->
        </li><!-- End Notification Nav -->

        <li class="nav-item dropdown pe-3">

          <a class="nav-link nav-profile d-flex align-items-center pe-0" data-bs-toggle="dropdown">
            <img id="profileImg" src="assets/img/satoshi3.jpg" alt="Profile" class="rounded-circle">
            <span class="d-none d-md-block dropdown-toggle ps-2">S. Nakamoto</span>
          </a>
          <script>
          // Load one of 5 random Profile Images
          // let profileImg = document.getElementById("profileImg");
          // var num = Math.floor( Math.random() * 6);
          // profileImg.src = 'assets/img/satoshi' + num + '.jpg';
          
          </script>

          <ul class="dropdown-menu dropdown-menu-end dropdown-menu-arrow profile">
            <li class="dropdown-header">
              <h6>Satoshi Nakamoto</h6>
              <span>Blockchain Developer</span>
            </li>
            <li>
              <hr class="dropdown-divider">
            </li>

         <!--   <li>
              <a class="dropdown-item d-flex align-items-center" href="users-profile.html">
                <i class="bi bi-person"></i>
                <span>My Profile</span>
              </a>
            </li>
            <li> --> 
       <!--     <li>
              <a class="dropdown-item d-flex align-items-center" href="#">
                <i class="bi bi-box-arrow-right"></i>
                <span>Sign Out</span>
              </a>
            </li> -->

          </ul><!-- End Profile Dropdown Items -->
        </li><!-- End Profile Nav -->

      </ul>
    </nav><!-- End Icons Navigation -->

  </header><!-- End Header -->

  <!-- ======= Sidebar ======= -->
  <aside id="sidebar" class="sidebar">

    <ul class="sidebar-nav" id="sidebar-nav">

      <li class="nav-item">
        <a class="nav-link collapsed" href="#balance" >
          <i style="transform: rotate(-0.03turn);" class="bi bi-currency-bitcoin"></i>
          <span >Balance</span>
        </a>
      </li>
      
     <li class="nav-item">
        <a class="nav-link collapsed" href="#mnemonic1">
          <i class="bx bxs-lock"></i>
          <span >Mnemonic / Seed</span>
        </a>
      </li>
      
            <li class="nav-item">
        <a class="nav-link collapsed" href="#deposit" >
          <i class="bi bi-safe-fill"></i>
          <span >Deposit</span>
        </a>
      </li>
      
      <li class="nav-item">
        <a class="nav-link collapsed" href="#coins" >
          <i class="bi bi-cash-coin"></i>
          <span >Coins / UTXOs</span>
        </a>
      </li>
      
      <li class="nav-item">
        <a class="nav-link collapsed" href="#sendBCHcard" >
          <i class="bi bi-send-check-fill"></i>
          <span>Send</span>
        </a>
      </li>
      
      <li class="nav-item">
        <a class="nav-link collapsed" href="#signverify" >
          <i class="bi bi-check-lg"></i>
          <span>Sign / Verify</span>
        </a>
      </li>
      

      
      <li class="nav-item">
        <a class="nav-link collapsed" onClick="faq()" >
          <i class="bi bi-question-circle"></i>
          <span >F.A.Q</span>
        </a>
      </li>
<!--
<hr width="65%" />
-->
<span style="font-size:8pt;font-style:italic;" id="linksMore" onclick="function dothis(){ document.getElementById('externalLinks').style.display = 'block'; }">External Links  + </span>
<div id="externalLinks" >
      <li class="nav-item">
        <a class="nav-link collapsed" href="https://electroncash.org" target="_blank">
          <i class="bi bi-incognito"></i>
          <span>Electron Cash Wallet</span>
        </a>
      </li>
      
      <li class="nav-item">
        <a class="nav-link collapsed" href="https://cashfusion.org" target="_blank">
          <i class="bi bi-incognito"></i>
          <span>CashFusion Privacy</span>
        </a>
      </li>
      
            <li class="nav-item">
        <a class="nav-link collapsed" href="https://paper.keepbitcoinfree.org" target="_blank">
          <i class="bi bi-wallet2"></i>
          <span>Paper BCH Wallet</span>
        </a>
      </li>

      <li class="nav-item">
        <a class="nav-link collapsed" onclick="window.print()" >
          <i class="bi bi-printer-fill"></i>
          <span>Print this Page</span>
        </a>
      </li>
</div>
      <!-- End F.A.Q Page Nav -->

    </ul>

  </aside><!-- End Sidebar-->



  <main id="main" class="main" >

<!-- if "isnew" = true this container will be displayed -->
    <div class="container">
      <img id="beaneater" src="assets/img/beaneater.gif" style="opacity:0.6;margin-left:2em;margin-top:2em" />
      <div id="newwalletview" class="hide">
        <fieldset style="margin-top: 25px;">
            <h4><i style="transform: rotate(-0.05turn);" class="bi bi-currency-bitcoin"></i> Create new wallet</h4>
            <input class="button primary" type="button" value="Create" onclick="createNewWallet()">
            <br><br>
            <hr>
            <br>
            <h4><i style="transform: rotate(-0.05turn);" class="bi bi-currency-bitcoin"></i> Import existing wallet</h4> 
            <div>Enter mnemonic seed phrase</div>
            <textarea style="resize: none;width:100%" id="enterSeedphrase" rows="3" placeholder="word1 word2 ..."></textarea>
            <span>Derivation path: </span>
            <select name="derivationPath" id="derivationPath"> <!-- onchange="selectDerivation(event)" -->
              <option value="m/44'/145'/0'/0/0">m/44/145/0/0/0 (standard HD wallet)</option>
              <option value="m/44'/0'/0'/0/0">m/44'/0'/0'/0/0 (bitcoin.com wallet)</option>
            </select> <br>
            <input class="button primary" type="button" style="margin-top:15px" value="Import" onclick="importWallet()">
            <br><br>
        </fieldset>
      </div>
    </div>

<div id="walletexists" class="hide">
    <div class="pagetitle">
      <h1>Wallet Dashboard</h1>
      <nav>
        <ol class="breadcrumb">
                    <li class="breadcrumb-item active"><a href="https://bitcoincash.org" target="_blank">Bitcoin Cash</a> </li>
          <li class="breadcrumb-item">Network: <span id='network'></span></li> 
                   <!-- <li class="breadcrumb-item"><a href="index.html">Home</a></li> -->
          <li class="breadcrumb-item"><a href="https://learnmeabitcoin.com/technical/derivation-paths" target="_blank">Derivation</a>: <span id="derivation1"></span></li>
        </ol>
      </nav>
      <span style="font-size: 14px;
    font-family: 'Nunito', sans-serif;
    color: #899bbd;
    font-weight: 600;" class="breadcrumb-item"></span>
    </div><!-- End Page Title -->

    <section class="section dashboard">
      <div class="row">

        <!-- Left side columns -->
        <div class="col-lg-12">
          <div class="row">

            <!-- Balance Card -->
            <div class="col-xxl-4 col-md-6">
              <div class="card info-card sales-card">

               <!-- <div class="filter">
                  <a class="icon" href="#" data-bs-toggle="dropdown"><i class="bi bi-three-dots"></i></a>
                  <ul class="dropdown-menu dropdown-menu-end dropdown-menu-arrow">
                    <li class="dropdown-header text-start">
                      <h6>Filter</h6>
                    </li>

                    <li><a class="dropdown-item" href="#">Today</a></li>
                    <li><a class="dropdown-item" href="#">This Month</a></li>
                    <li><a class="dropdown-item" href="#">This Year</a></li>
                  </ul>
                </div> -->

                <noscript>
                  <div style="color:red">
                    * This website requires JavaScript to function properly. Please enable JavaScript in your browser to create a new Bitcoin Cash wallet. If you don't want to use JavaScript, check out the <a href="https://electroncash.org" target="_blank">Electron Cash</a> Desktop/Mobile wallet.
                  <br /><br />
                  </div>
                </noscript>

                <div class="card-body">
                  <h5 id="balance" class="card-title">Total Balance <span>| BCH </span></h5>

                  <div class="d-flex align-items-center">
                    <div style="transform: rotate(-0.03turn);" class="success card-icon rounded-circle d-flex align-items-center justify-content-center">
                      <i class="bi bi-currency-bitcoin"></i>
                    </div>
                    <div class="ps-3">
                      <h6 id="bal">Loading...</h6>
                    <span id="sats" class="text-success small pt-1 fw-bold"></span> <span class="text-muted small pt-2 ps-1">Satoshis</span>

                    </div>
                  </div>
                </div>

              </div>
            </div><!-- End Balance Card -->

            <!-- Value Card -->
            <div class="col-xxl-4 col-md-6">
              <div class="card info-card revenue-card">

             <!--   <div class="filter">
                  <a class="icon" href="#" data-bs-toggle="dropdown"><i class="bi bi-three-dots"></i></a>
                  <ul class="dropdown-menu dropdown-menu-end dropdown-menu-arrow">
                    <li class="dropdown-header text-start">
                      <h6>Filter</h6>
                    </li>

                    <li><a class="dropdown-item" href="#">Today</a></li>
                    <li><a class="dropdown-item" href="#">This Month</a></li>
                    <li><a class="dropdown-item" href="#">This Year</a></li>
                  </ul>
                </div> -->

                <div class="card-body">
                  <h5 class="card-title">Total Value <span>| USD</span></h5>

                  <div class="d-flex align-items-center">
                    <div class="card-icon rounded-circle d-flex align-items-center justify-content-center">
                      <i class="bi bi-currency-dollar"></i>
                    </div>
                    <div class="ps-3">
                      <h6>$<span id="balusd"> Loading...</span></h6>
                     <span class="text-success small pt-1 fw-bold">1 BCH = $<span id="bchprice"></span> </span> <span class="text-muted small pt-2 ps-1"></span> 

                    </div>
                  </div>
                </div>

              </div>
            </div><!-- End Value Card -->

            <!-- Mnemonic Card -->
            <div class="col-xxl-4 col-xl-12">

              <div class="card info-card customers-card" id="mnemonic1">

               <div class="filter">
                  <a class="icon" href="#" data-bs-toggle="dropdown"><i class="bi bi-three-dots"></i></a>
                  <ul class="dropdown-menu dropdown-menu-end dropdown-menu-arrow">
                    <li class="dropdown-header text-start">
                      <h6>Menu</h6>
                    </li>
                    <li id="showMnemonicMenu"><a class="dropdown-item" onClick="showMnemonic()">Show Mnemonic</a></li>
                    <li id="hideMnemonicMenu" style="display:none;" ><a class="dropdown-item" onClick="hideMnemonic()">Hide Mnemonic</a></li>
                    <li><a class="dropdown-item" onClick="hideMnemonicTab()">Hide this Tab</a></li>
                    <li><a class="dropdown-item" onClick="showMnemonicTab()">Show this Tab</a></li>
                    <li><a class="dropdown-item" onClick="deleteWallet()">DELETE this wallet </a></li>
                 <!--   <li><a class="dropdown-item" href="#">This Month</a></li>
                    <li><a class="dropdown-item" href="#">This Year</a></li> -->
                  </ul>
                </div> 

                <div class="card-body" id="theMnemonic">
                  <h5 class="card-title">Mnemonic <i style="font-size:18pt" id="lock" class="bx bxs-lock"></i><i id="lock-open" style="font-size:18pt;display:none;" class="bx bxs-lock-open"></i><span> | Seed Phrase<br /><a href="https://learnmeabitcoin.com/technical/derivation-paths" target="_blank">Derivation</a>: <span id="derivation"></span></span></h5>

                  <div class="d-flex align-items-center">
               <!--      <div class="card-icon rounded-circle d-flex align-items-center justify-content-center">
                     
                    </div> -->
                    <div class="ps-3">
                      <h5 id="mnemonic">Loading...</h5>
                    <!--  <span class="text-danger small pt-1 fw-bold">12%</span> <span class="text-muted small pt-2 ps-1">decrease</span> -->

                    </div>
                  </div>

                </div>
              </div>

            </div><!-- End Mnemonic Card -->
            
            
            <!-- Deposit Address Card -->
            <div class="col-xxl-8 col-xl-12">

              <div class="card info-card customers-card" >

               <div class="filter">
                  <a class="icon" href="#" data-bs-toggle="dropdown"><i class="bi bi-three-dots"></i></a>
                  <ul class="dropdown-menu dropdown-menu-end dropdown-menu-arrow">
                    <li class="dropdown-header text-start">
                      <h6>Menu</h6>
                    </li>

                <!--    <li><a class="dropdown-item" onClick="getNewDepositAddr()">Create More Deposit Addresses</a></li> -->
                 <!--   <li><a class="dropdown-item" href="#">This Month</a></li>
                    <li><a class="dropdown-item" href="#">This Year</a></li> -->
                  </ul>
                </div> 

                <div class="card-body">
                  <h5  id="deposit" class="card-title">Deposit Address <i style="font-size:18pt;transform: rotate(-0.03turn);" class="ri ri-bit-coin-fill"></i> <span>| Cash Address Format</span></h5>

                  <div class="d-flex" style="padding-top:10px;">
                  <!--  <div style="transform: rotate(-0.02turn);" class="card-icon rounded-circle d-flex align-items-center justify-content-center">
                      
                    </div> -->
                    <div class="ps-3" style="width:100%;word-wrap:break-word;">
                      <h3 style="font-size:14pt;word-wrap:break-word;" id="cashaddr">Loading Bitcoin Cash Address...</h3> 
                      <!-- TODO: ADD COPY BUTTON! -->
                    <!--  <span class="text-danger small pt-1 fw-bold">12%</span> <span class="text-muted small pt-2 ps-1">decrease</span> -->
                 <!--   <p style="text-align:center;"> -->
                     
                  <!-- </p> -->
                  <p style="text-align: center;">
                   <img src="assets/img/wait.svg" style="width:60%;max-width:15em;" id="depositqr">
                  </p>

                  <p id="addresses">
                    

                  </p>

                    <!-- Basic Modal style="display:none;" -->
                    <button style="display:none;" id="modalbtn" type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#utxoModal">
                      Test Incoming Transaction
                    </button>
<!--
                    <button style="display:none;" onClick="createNotif()" id="notificationbtn" type="button" class="btn btn-primary">
                      Test Notification
                    </button> -->
                    
                    <div class="modal fade" id="utxoModal" tabindex="-1" data-bs-backdrop="false">
                      <div class="modal-dialog">
                        <div class="modal-content" data-bs-backdrop="false">
                          <div class="modal-header">
                            <h5 id="txdetectheader" class="modal-title">New TXID Detected</h5>
                            <button type="button" class="btn-close" onClick="reloadBal()" data-bs-dismiss="modal" aria-label="Close"></button>
                          </div>
                          <div id="txdetectbody" class="modal-body">
                            A new incoming transaction has been detected for your Deposit Address - <span id="cashaddr2"></span>.  The TX Hash is <span id="txhash">xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx</span>.<br /><br />

                            <span id="txouts"></span>
                          
  
                          
                          </div>


                          <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" onClick="reloadBal()">Close</button>
                            <!-- <button type="button" class="btn btn-primary">Okay</button> -->
                          </div>
                        </div>
                      </div>
                    </div><!-- End Basic Modal-->



                    <!-- Basic Modal style="display:none;" -->
                    <button style="display:none;" id="faqmodalbtn" type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#FAQModal">
                      Test FAQ Modal
                    </button>
                    
                    <div class="modal fade" id="FAQModal" tabindex="-1">
                      <div class="modal-dialog">
                        <div class="modal-content">
                          <div class="modal-header">
                            <h5 class="modal-title">BCH Admin FAQ</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                          </div>
                          <div class="modal-body">
                          <div class="card-body" id="faq-modal">
                          <h5 class="card-title">Frequently Asked Questions</h5>

                          <div class="accordion accordion-flush" id="faq-group-1">

                            <div class="accordion-item">
                              <h2 class="accordion-header">
                                <button class="accordion-button collapsed" data-bs-target="#faqsOne-1" type="button" data-bs-toggle="collapse" aria-expanded="false">
                                  What is BCH Admin?
                                </button>
                              </h2>
                              <div id="faqsOne-1" class="accordion-collapse collapse" data-bs-parent="#faq-group-1" style="">
                                <div class="accordion-body">
                                  BCH Admin is a non-custodial & serverless Bitcoin Cash Web Wallet. Private keys are safely stored within your browser. To learn more about how the Bitcoin Cash wallet is created and persisted, visit <a href="https://mainnet.cash/tutorial" target="_blank">Mainnet.cash</a>. The BCH wallet created and persisted is local to the [ browser / device / domain ] that is used. This means if you use a different device, browser or domain, then a different wallet will be created. Be sure to back up your <a href="https://learnmeabitcoin.com/technical/keys/hd-wallets/mnemonic-seed/" target="_blank">Mnemonic Seed Phrase</a> and <a href="https://learnmeabitcoin.com/technical/keys/hd-wallets/derivation-paths/" target="_blank">Derivation Path</a> so that you can restore your BCH on any other Bitcoin Cash wallet. 
                                </div>
                              </div>
                            </div>

                            <div class="accordion-item">
                              <h2 class="accordion-header">
                                <button class="accordion-button collapsed" data-bs-target="#faqsOne-2" type="button" data-bs-toggle="collapse" aria-expanded="false">
                                  What is Bitcoin Cash?
                                </button>
                              </h2>
                              <div id="faqsOne-2" class="accordion-collapse collapse" data-bs-parent="#faq-group-1">
                                <div class="accordion-body">
                                  <a href="https://bitcoincash.org" target="_blank">Bitcoin Cash</a> is a <a href="https://keepbitcoinfree.org/bitcoin.pdf" target="_blank">purely peer-to-peer version of electronic cash</a>, created in 2009 by <a href="https://satoshi.nakamotoinstitute.org" target="_blank">Satoshi Nakamoto</a>. Where the BTC fork has repeatedly failed to scale and act as a functional currency (high fees, slow confirmation times), Bitcoin Cash (BCH) has successfully scaled on-chain with larger blocks (32MB+), consistently low fees, and instant 0-conf transactions. Low fees and instant 0-conf transactions used to be features of BTC, but now only exist within BCH. <a href="https://whybitcoincash.com" target="_blank">Why Bitcoin Cash?</a>
                                </div>
                              </div>
                            </div>

                            <div class="accordion-item">
                              <h2 class="accordion-header">
                                <button class="accordion-button collapsed" data-bs-target="#faqsOne-3" type="button" data-bs-toggle="collapse" aria-expanded="false">
                                  Is BCH Admin secure?
                                </button>
                              </h2>
                              <div id="faqsOne-3" class="accordion-collapse collapse" data-bs-parent="#faq-group-1">
                                <div class="accordion-body">
                                  <a href="https://github.com/KeepBitcoinFree-org/bch-admin" target="_blank">The BCH Admin code is open source so you can verify what the code is doing</a>. The website itself is serverless (zero backend code) and only uses HTML, CSS & <i>clearly written, albeit a bit sloppy,</i> client-side JavaScript: utilizing the <a href="https://mainnet.cash" target="_blank">mainnet-js library/scripts</a> to interact with the Bitcoin Cash blockchain and store the private keys within the Browser's IndexDB Storage. There is no malicious code that I am aware of within the index.html, or included JavaScript assets. Everyone is welcome to review the source code to confirm that. <br /><br />BCH Admin uses an SSL certificate to encrypt communications on the website and mainnetjs essentially opens a websocket to a Bitcoin Cash node within your browser (whereas Electron Cash does this within the electron desktop application). You can also easily download the source code and host the wallet locally. The code still reaches out to third party nodes to verify tx data and broadcast transactions. The private keys used to sign transactions do not ever leave your browser's local storage and are not saved anywhere else. 
                                  <br /><br />
                                  * Please note that this software is offered AS IS with NO GAURANTEE that your funds will be safe. WE (https://KeepBitcoinFree.org) DOES NOT EVER HOLD YOUR PRIVATE KEYS; WE CANNOT, AND DO NOT WISH TO, STEAL YOUR Bitcoin Cash, BCH. This application is serverless, all keys are stored in your browser. Back up your seed phrase and derivation to restore your coins on any other Bitcoin Cash wallet.
                                </div>
                              </div>
                            </div>
                          </div>

                          </div>
                          <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            <!-- <button type="button" class="btn btn-primary">Okay</button> -->
                          </div>
                        </div>
                      </div>
                    </div><!-- End Basic Modal-->
                    
                    </div>
                  </div>

                </div>
              </div>  <!-- END MODALS ? -->

            </div><!-- End Deposit Address Card -->
            
            </div> <!-- End Row? -->
            
            <!-- UTXO DATATABLE Card -->
            <div class="col-xxl-12 col-xl-12">

              <div id="utxocard" class="card recent-sales overflow-auto">
<!--
               <div class="filter">
                  <a class="icon" href="#" data-bs-toggle="dropdown"><i class="bi bi-three-dots"></i></a>
                  <ul class="dropdown-menu dropdown-menu-end dropdown-menu-arrow">
                    <li class="dropdown-header text-start">
                      <h6>Menu</h6>
                    </li>
                    <li><a class="dropdown-item" onClick="hideMnemonicTab()" href="#">Hide Tab</a></li>
                    <li><a class="dropdown-item" onClick="showMnemonic()" href="#">Show Mnemonic</a></li>
                   <li><a class="dropdown-item" href="#">This Month</a></li>
                    <li><a class="dropdown-item" href="#">This Year</a></li> 
                  </ul>
                </div> -->

                <div class="card-body">
                  <h5 id="coins" class="card-title">Coins <i style="font-size:18pt;" class="bx bxs-coin-stack"></i> <span>| <span id="utxoLen" style="font-size:11pt;"></span>UTXOs - Unspent Transaction Outputs</span></h5>

                  <div class="align-items-center">
                <!--    <div class="card-icon rounded-circle d-flex align-items-center justify-content-center">
                      <i class="bx bxs-coin-stack"></i>
                    </div> -->
                    <div class="ps-3">
                      <!-- UTXO TABLE -->
                      <table id="utxoTable" style="width:100%;" class="table table-borderless"> 
                          <tbody id="tbody">
                            <thead><tr><th scope='col'>Spend</th><th scope='col'>TxID</th><th scope='col'>Satoshis</th><th scope='col'>Height</th><th scope='col'>Status</th></tr></thead>
                          </tbody>
                      </table>
                      <!-- END UTXO TABLE -->
                    </div>
                  </div>

                </div>
              </div>

            </div><!-- End UTXO Card -->
            
            
            

            
             <!-- SEND BCH Card -->
            <div id="send" class="col-xxl-8 col-xl-12">

              <div id="sendBCHcard" class="card info-card customers-card">

               <div class="filter">
                  <a class="icon" href="#" data-bs-toggle="dropdown"><i class="bi bi-three-dots"></i></a>
                  <ul class="dropdown-menu dropdown-menu-end dropdown-menu-arrow">
                    <li class="dropdown-header text-start">
                      <h6>Menu</h6>
                    </li>
                    <li><a class="dropdown-item" onClick="clearSendForm()">Clear</a></li>
                 <!--   <li><a class="dropdown-item" onClick="showMnemonic()" href="#">Show Mnemonic</a></li>
                    <li><a class="dropdown-item" href="#">This Month</a></li>
                    <li><a class="dropdown-item" href="#">This Year</a></li> -->
                  </ul>
                </div> 

                <div class="card-body">
                  <h5 class="card-title">Send BCH <i style="font-size:18pt;" class="ri ri-secure-payment-fill"></i> <span> | p2p electronic cash </span> <img src="assets/img/fluid-loader.gif" id="loader" style="display:none;padding-left:100px;width:200px;"><span id="send-error"></span></h5>

                  <div class="d-flex align-items-center">
               <!--     <div class="card-icon rounded-circle d-flex align-items-center justify-content-center">
                      <i class="ri ri-secure-payment-fill"></i>
                    </div> -->
                    <div class="ps-3">
                      <span style="display:none;" id="txdata"></span>
                    Select UTXOs from the table above, or enter a custom amount.<br />

                    <!-- Floating Labels Form -->
                          
                    <!-- ADDRESS -->
                    <form id="sendbchform" class="row g-3 needs-validation was-validated" novalidate>
                      <div class="col-md-12">
                        <div class="form-floating">
                          <input type="text" class="form-control" id="sendtoaddress" required>
                          <label for="sendtoaddress">Send to Address</label>
                          <span style="" id="sendtoaddresserror"></span>
                            <div style="" class="invalid-feedback">
                              Please enter a valid bitcoincash: Address.
                            </div>
                        </div>
                      </div>
                      
                      <!-- AMOUNT -->
                      <div class="col-md-12">
                        <div class="form-floating">
                          <!-- TODO: Make send-total input readonly and add logic for selecting UTXOs oninput="calcUsd()" -->
                          <input type="number" class="form-control" id="send-total" name="amount" min=0.00000001 value=0.00000000 step="0.00000001" readonly required> ($<span id="send-totalusd">0.00</span> USD) 
                           <br />
                            <div style="" class="invalid-feedback">
                              Enter a valid amount over 0.
                            </div>
                            <div style="display:none" id="needfunds" class="invalid-feedback">
                              User balance is not enough. Send more BCH to your deposit address.
                            </div>
                            
                          <br />  <input type="checkbox" onClick="sendCustomAmount()" id="customamount" name="customamount"> Send Custom Amount <br />
                          <br /><input type="checkbox" id="sendmax" name="sendmax"> Send Max
                        <!--  <input type="hidden" id="send-total-amount" value="0.00000000" readonly> -->
                          
                          <label for="send-total">Send Amount (BCH)</label>
        
                        </div>
                      </div>

                      <span style="font-size:10pt;">* Fees will be subtracted from the total to be sent. Fees are always low with Bitcoin Cash.</span>
                      <div class="text-center">
                        <button onClick="sendBCH()" type="button" class="btn btn-primary">Submit</button>
                        <div id="resetSendForm" onClick="resetSendBCHform()" class="btn btn-secondary">Reset</div>
                      </div>
                    </form><!-- End floating Labels Form -->

                    <!-- Custom JavaScript for Sending Custom BCH amount -->
                    <script type="text/javascript">
                    
                    function sendCustomAmount() {
                      let checked = document.getElementById('customamount').checked;
                      var sendTotal = document.getElementById('send-total'),
                        totalUsd = document.getElementById('send-totalusd');

                      
                      // if custom amount has been clicked, make send-total editable and disable the utxo checkboxes.
                      if(checked){
                        sendTotal.readOnly = false;
                        
                        //forEach
                        var inputs = document.getElementsByClassName('coinsum');
                        
                        var arrayLength = inputs.length;
                        for (var i = 0; i < arrayLength; i++) {
                          let input = inputs[i];
                                                    
                          // uncheck all checked utxos and reset totals via clicking the already checked boxes.
                          if(input.checked == true){
                            input.click();
                          }
                          // disable utxo checkboxes.
                          input.disabled = true;
                        };

                        
                        
                        
                        // start calcUsd
                       sendTotal.addEventListener('input', function calcUsd() {

    const filterNum = (str) => {
      const numericalChar = new Set([ ".",",","0","1","2","3","4","5","6","7","8","9" ]);
      str = str.split("").filter(char => numericalChar.has(char)).join("");
      return str;
  }
  
      total  = document.getElementById('send-total'),
      totalUsd = document.getElementById('send-totalusd'),
      bal = document.getElementById('bal');

      bal = filterNum(bal.innerHTML);
      console.log('balance = ' + bal);
      
            // Currently using price that was generated on page load.
            var totalUsdVal = US.format(total.value * thebchPrice);
            // Showing user the totals
            totalUsd.innerHTML = totalUsdVal;
            // Debug console log
    //        console.log('total.value = '+ total.value);
    
    // Check if the user entered send amount is more than user balance and show error if so.
    if( total.value > Number(bal)){
      console.log('user doesnt have enough funds');
      // show error
      document.getElementById('needfunds').style.display = 'inline';
    }else{
      // dont show error
      document.getElementById('needfunds').style.display = 'none';
    }
    
  }, true); // end calcUsd();
  
  
                      }else{ // if custom amount has been unchecked, make send-total non-editable and re-enable the utxo checkboxes.
                        // Also need to CLEAR the send-total and usd.

                        sendTotal.readOnly = true;
                        sendTotal.value = 0.00000000;
                        totalUsd.innerHTML = '0';
                        
                        //forEach
                        var inputs = document.getElementsByClassName('coinsum');
                        
                        var arrayLength = inputs.length;
                        for (var i = 0; i < arrayLength; i++) {
                          let input = inputs[i];

                          // re-enable utxo checkboxes.
                          input.disabled = false;
                        };
                      }
                    }
                    
                    function resetSendBCHform() {
                      // set vars
                      var resetBtn = document.getElementById('resetSendForm'),
                      sendtotal = document.getElementById('send-total'),
                      totalUsd = document.getElementById('send-totalusd'),
                      sendBCHform = document.getElementById('sendbchform'),
                      coinsum = document.getElementsByClassName('coinsum'),
                      customamount = document.getElementById('customamount');
                      
                   //   console.log('customamount.checked = ' + customamount.checked);
                      if(customamount.checked){
                        
                          // there might be a custom input, reset the form values and the usd calcuations.
                        //sendBCHform.reset();
                        sendtotal.value = 0.00000000;
                        totalUsd.innerHTML = '0'; 
                        
                        
                      }else{
                                              // check if utxos are selected and de-select them, if so.

                                                //forEach
                        var inputs = document.getElementsByClassName('coinsum');
                        
                        var arrayLength = inputs.length;
                        for (var i = 0; i < arrayLength; i++) {
                          let input = inputs[i];

                          // de-select utxo checkboxes if they are checked
                          if(input.checked){
                            input.click();
                          }
                        }                    
                      }
                      
                      
                    }
                    
                    
                    </script>
                    
                  </div>

                </div>
              </div>

            </div><!-- End SEND BCH Card -->


          <!-- Start SIGN / VERIFY MESSAGE CARD -->
          <div class="col-xxl-12 col-xl-12">
             <div id="signverify" class="card info-card customers-card">

               <div class="filter">
                  <a class="icon" href="#" data-bs-toggle="dropdown"><i class="bi bi-three-dots"></i></a>
                  <ul class="dropdown-menu dropdown-menu-end dropdown-menu-arrow">
                    <li class="dropdown-header text-start">
                      <h6>Menu</h6>
                    </li>
                    <li><a class="dropdown-item" onClick="clearVerifyForm()" href="#">Clear</a></li>
                 <!--   <li><a class="dropdown-item" onClick="showMnemonic()" href="#">Show Mnemonic</a></li>
                    <li><a class="dropdown-item" href="#">This Month</a></li>
                    <li><a class="dropdown-item" href="#">This Year</a></li> -->
                  </ul>
                </div> 

                <div class="card-body">
                  <h5 id="signverifyheader" class="card-title">Sign or Verify <i style="font-size:18pt;" class="bx bx-check-shield"></i> <span> | Messages with your Address & Private Key</span> </h5>

                  <div class="d-flex align-items-center">
                    <div class="ps-3">
                        <span style="" id="sigformessage"></span>
                          <span style="" id="signverifymessageerror"></span>
                      <!-- TODO: Add tabs for Sign / Verify... or hide/show inputs for WIF and verify button -->
                      <form id="signverifyform" class="row g-3">
                      <div class="col-md-12">
                        <div class="form-floating">
                        <input type="text" class="form-control" name="signverifymessage" id="signverifymessage" size="100%" required>
                         <label for="signverifymessage">Message to Sign or Verify</label> 
                            <div id="signverifymsgerror" style="display:none;" class="invalid-feedback">
                              Please enter a message to sign or verify.
                            </div>
                          </div>
                          <br />
                          <div class="form-floating">
                          <input type="text" class="form-control" name="signaturetoverify" id="signaturetoverify" size="100%" onblur="showVerifyBtn()" oninput="showVerifyBtn()">
                          <label for="signaturetoverify">Signature to Verify</label>



                            <!-- TODO: provide functionality to use different WIF
                            Or just provide functionality to restore wallet from different WIF/seed, then you can sign/verify with that? -->
                            <br />
                           <!-- <input style="font-size:10pt;" type="checkbox" id="customWIF" name="customWIF" disabled> Use different WIF instead of current wallet? -->
                        </div>
                      
                       <div class="text-center">
                         
                        <button id="signBtn" onClick="signMessage()" type="button" class="btn btn-primary">Sign</button>
                        <button id="verifyBtn" style="display:none;" onClick="verifyMessage()" type="button" class="btn btn-primary">Verify</button> 
                        <!-- <button style="opacity:0.4" type="button" class="btn btn-secondary">Verify</button> -->
                        <button id="resetVerifyForm" type="reset" class="btn btn-secondary">Reset</button>

                        <!-- <button id="resetSendForm" type="reset" class="btn btn-secondary">Reset</button> -->
                       </div>
                       </form>
                       </div>
                      </div>
                    </div>
                  </div>
          </div>
          <!-- End SIGN / VERIFY MESSAGE CARD -->

          </div>
        </div><!-- End Left side columns -->


      </div>
    </section>
</div>
  </main><!-- End #main -->

  <!-- ======= Footer ======= -->
  <footer id="footer" class="footer">
    <div class="copyright">
      <strong><span><a href="https://KeepBitcoinFree.org" target="_blank">KeepBitcoinFree.org</a></span></strong> | <a href="https://github.com/KeepBitcoinFree-org/bch-admin" target="_blank">Fork me.</a> | <a href="https://mainnet.cash/tutorial" target="_blank">mainnet-2.2.5.js</a>
    </div>
  <!--  <div class="credits">
      null.
    </div> -->
  </footer><!-- End Footer -->

  <a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

  <!--  JS Files -->
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script> 
  <script src="assets/js/main.js"></script>

</body>

</html>
